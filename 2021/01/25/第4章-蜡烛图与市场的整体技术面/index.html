<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">




  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2">





















<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="思考并回答以下问题：">
<meta name="keywords" content="日本蜡烛图技术新解">
<meta property="og:type" content="article">
<meta property="og:title" content="第4章 蜡烛图与市场的整体技术面">
<meta property="og:url" content="http://yoursite.com/2021/01/25/第4章-蜡烛图与市场的整体技术面/index.html">
<meta property="og:site_name" content="车斌的技术博客">
<meta property="og:description" content="思考并回答以下问题：">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2021-01-28T13:10:23.428Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="第4章 蜡烛图与市场的整体技术面">
<meta name="twitter:description" content="思考并回答以下问题：">






  <link rel="canonical" href="http://yoursite.com/2021/01/25/第4章-蜡烛图与市场的整体技术面/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>第4章 蜡烛图与市场的整体技术面 | 车斌的技术博客</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">车斌的技术博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">专注</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2021/01/25/第4章-蜡烛图与市场的整体技术面/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="CheBin">
      <meta itemprop="description" content="放弃会成为一种习惯">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="车斌的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">第4章 蜡烛图与市场的整体技术面

              
            
          </h1>
        

        <div class="post-meta">

          

          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-01-25 14:56:16" itemprop="dateCreated datePublished" datetime="2021-01-25T14:56:16+08:00">2021-01-25</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2021-01-28 21:10:23" itemprop="dateModified" datetime="2021-01-28T21:10:23+08:00">2021-01-28</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/期货/" itemprop="url" rel="index"><span itemprop="name">期货</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">9.9k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">9 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>思考并回答以下问题：</p>
<a id="more"></a>
<p>我曾经翻译过的一本日文书中有言：“无视市场情况而贸然投资，必将遭受伏击，损兵折将。”日本人常将军事术语引入技术分析。这句话很形象地告诉我们：依据蜡烛图进行买卖决策前，一定要先考虑市场的整体状况，否则难免亏损。</p>
<p>日本技术分析师协会的一位会员曾给我来信说，在他眼中，市场整体技术面的重要性远大于一个个孤立的蜡烛图形态。我完全同意这种看法。要掌握有效的蜡烛图交易技术，不但需要对蜡烛图有正确的理解，而且要采取稳定而连贯的交易战略和策略。可惜一些交易者只懂得蜡烛图形态，却往往忽视了那些交易策略。蜡烛图必须与其他交易策略原则有机结合，才能成为一个有效的工具。从这个意义上说，蜡烛图虽然很重要，但也仅仅是我的工具箱中的诸多工具之一。</p>
<p>有弟子曾问孔子：他会带哪种秉性的人上战场？孔子回答说，他要的不是视死如归的莽汉，而是谨慎面对困难、以策略谋胜的战士。策略也正是本章的主题。我拟阐述几个策略原则的重要性：止损、风险与收益的权衡、以大势为背景观察个股的蜡烛图、交易后跟踪市场的变化。只有全面掌握、使用这些策略原则，你才能真正发挥蜡烛图的力量。当你认真理解本章的内容后，你将会意识到：某个蜡烛图形态形成前后所出现的因素，才是交易成败的关键因素。</p>
<h1 id="止损"><a href="#止损" class="headerlink" title="止损"></a><span style="color:#339AFF;">止损</span></h1><p>当价格到达某个点位时，你必须承认你的判断出了错，而这个价位就是你的止损点。无论某种技术分析工具如何可靠，它总会在某个时点给出错误的信号。贯彻止损策略，就等于控制交易的风险度。事实上，止损是技术分析中一个极为重要的方面，是一种风险管理的手段。</p>
<p>很多蜡烛图形态组合代表着压力或者支撑，比如乌云盖顶就是一种压力形态。如果你根据这个形态进行放空操作，止损点就应该是乌云盖顶最高点的上方。在图4-1中，1月开始的上升趋势出现了停滞，形成乌云盖顶的压力区，之后的7个交易日中市场受阻于这个压力区，上升态势转为横盘。但第8天出现了跳空上行的缺口（窗口），收盘价高出压力区的高点，由此发出信号：市场将再度上行。</p>
<p>一旦市场实际与主观判断背道而驰，人性的弱点决定了有些交易者会变得一厢情愿的盲目。例如，在图4-1中，市价已经上穿了止损位（乌云盖顶的高点），而某些做空者只会妄想着价格重新转入下跌，但在市场中常常事与愿违。一厢情愿的成本总是太高昂，恰如一句日本俗语所说，它就像“倚靠白云的梯子”，只会导致坠落。</p>
<p>如图4-2所示，1993年4月，大盘出现一个向上的跳空窗口。根据蜡烛图理论，这是一个支撑缺口，在9月出现的回调中，它确实一直起着支撑作用。面对这样一个缺口，交易者可以在回调到缺口区某个点位时买入，而此前做多者则应该把止损卖出点设在缺口底部下方，在周收盘（即周五收盘价）到达该点位时卖出。读者应该注意到，虽然该缺口在周内一度被完全回补，但空头力量有限，无力把股价长期压制在缺口下方。在这个例子中，尽管这是一个支撑缺口，但股价回调到缺口下方后，它所带来的情绪压力却使很多投资者难以忍受，尽管此后在周五收盘前，股价又被拉回缺口底部之上。它昭示我们，投资者的个性和修养也是交易成败的关键因素。</p>
<blockquote>
<p>图4-1 超越乌云盖顶形态：1993年3月债券</p>
</blockquote>

<p>在图4-3中，Amgen股价的上升缺口体现出支撑力，在11月的回调中始终没有被回补。回抽考验确认市场状况良好，推动股价向上突破75美元的高位。到达该价位后，蜡烛图形态呈包孕状（前一个蜡烛图完全包住后一个蜡烛图），显露出危险的迹象，并在随后的几个交易周内走出典型的头肩顶（S-H-S）形态（日本人称之为“三佛形态”）。一旦股价跌破头肩顶的颈线，往往意味着多头应该离场。如果股价封闭了原先支撑上涨的缺口，到达其下方，那就是市场转弱的最后一次预警，1993年年初的情况就是如此。支撑缺口的完全封闭，是场内的多头止损卖出的信号。</p>
<blockquote>
<p>图4-2 止损与风险耐受力</p>
</blockquote>

<blockquote>
<p>图4-3 止损：Amgen—日线</p>
</blockquote>

<h1 id="风险与收益的权衡"><a href="#风险与收益的权衡" class="headerlink" title="风险与收益的权衡"></a><span style="color:#339AFF;">风险与收益的权衡</span></h1><p>“择时而攻、择时而退者胜。”</p>
<p>参加完我的技术分析训练后，有些学员对新学来的蜡烛图技巧跃跃欲试，一回去就急不可耐地依据它进行交易。殊不知，就像我翻译过的一本日文书（一本交易必读书）中所说：“耐心等待时间之窗的开启；耐心是交易者成功的最重要的品性。”这就是说，理想的蜡烛图形态出现时，并不意味着最佳交易时机已来临。我警示学员，在判断最佳入场时机之前，应该先权衡一下风险与收益的比率。我曾经在一个机构投资者那里做过一期特别的培训，一位听过课的交易员后来来信说：“你说得真对，对蜡烛图的零星认识只会带来危险。全办公室的人都在激动地喊着‘十字星、十字星’。”</p>
<p>权衡风险与收益，就意味着设定止损点，这是控制风险的手段；同时还意味着设定目标价位，也就是潜在的回报。目标价位的确定有多种方式，包括艾略特波浪理论、支撑位和压力位等。由于蜡烛图技术通常不能给出目标价位，我常常推荐人们将西方技术分析与蜡烛图结合起来使用。蜡烛图最擅长发出趋势反转或者趋势持续的信号，而西方技术分析工具中的回调幅度与趋势线等有助于设定目标位。当然，你也许已经有了自己的目标价位设定方法。</p>
<p>请记住，在某个蜡烛图形态完成时，除非你判定风险与回报比率很诱人，否则请放弃交易。有句日本俗语所说的极是：“勇士的潜能是一张拉满的弓，但关键在于放弦的时机。”放弦的时机就取决于对风险与收益比率的研判。</p>
<p>在很多情况下，你只能拉弓等待。比如，当蜡烛图形态中多头或者空头信号出现时，如果风险与收益比率并不诱人，你应该放弃交易（除非你的交易是为了对冲保值）。如市场处于长阴长阳交错出现的大幅震荡时期，交易者也该退场观望。某日本技术分析著作将此种状况描述为“像8级地震”。如果有谁试图在此时入场交易，就如同一本日本书中所说的：“这是一种无谓的牺牲，一点不好玩。”</p>
<p>在图4-4中，9月初出现了阴包阳、呈吞噬状的熊市蜡烛图形态。由于吞噬性阴线的高点为压力点，所以，交易者如果此时想做空，止损点可以设定在这个形态的高点465的上方，以锁定风险。而目标价位则可以参照上月中旬的（或其他）上升缺口。这样一来，止损风险相比目标价位所体现的收益潜力来说很低，这个空头吞噬蜡烛图形态就构成了一个诱人的做空时机。</p>
<blockquote>
<p>图4-4 蜡烛图与风险收益比</p>
</blockquote>

<p>在图4-5中，1月出现了一个多头吞噬，股价由此回升，后来出现了一个上升缺口，两个交易日后，又是一根吞噬形态的长阴线。如果依此形态卖空，交易者必须问一个问题：此时卖空，风险收益比率诱人吗？（一般来说，股市卖空相对较少，但不妨以此蜡烛图指导其他市场的买卖，如期货市场，期货中做空比较常见。）如果全面分析技术形态，权衡风险与收益，就可发现这笔交易形同鸡肋，原因在于空头吞噬前面出现的上升缺口，如在当前价位卖空，止损点应该设定在大阴线的上方，而作为目标价位的上升缺口就在下方不远处，这样，风险与收益只能打个平手，这笔交易的收益风险比率很低。几周之后，蜡烛图走出了乌云盖顶的组合，此时如果以乌云盖顶的顶部为止损点，以上升缺口的底部为目标价位进行放空交易，将是一次收益不菲的战机。</p>
<p>图4-5　蜡烛图与风险收益比的重要性：沃尔玛—日线</p>
<p>图4-5说明了一个道理：很难在多个蜡烛图技术形态中确定哪个更重要，哪个更能说明问题。这张图中有一个空头吞噬形态。一般认为，阴线吞噬部分阳线的乌云盖顶组合所显露的空头威力要大大弱于空头吞噬。但是就本例而言，依据乌云盖顶形态卖空相比依据空头吞噬卖空，能够获得更好的交易收益机会。</p>
<p>图4-6显示，一个看涨的蜡烛图信号并不能保证新多获利。1月8～10日，蜡烛图走出了一个启明星的看涨组合，10日（当日启明星形态完成）的收盘价为1205美元。此时的价位是否值得买入？我们来做一次风险收益比率评估。首先要确定收益潜力。我们看到，上一年11月下旬的1220美元附近曾是一个支撑位，根据两极转换原理，原先的支撑位现在（1月上旬，看多启明星形成之时）变成了压力位，交易员因此可以预计反弹会到达1220这个阻力区附近，因此目标价格也就在1220附近。其次，我们来控制风险，依据蜡烛图理论，启明星的低点1169美元应该为现在的支撑位，也就是说止损位应在启明星低点1169的下方，如果未来的某个收盘价低于这个点，做多者应止损离场。</p>
<p>图4-6　风险收益比：1992年3月可可</p>
<p>由此可见这笔交易的几个参数：买入点为1205美元（启明星形态完成时的价位），止损位为1169美元，收益目标价位为1220美元。这就意味着36美元的风险与15美元的目标收益。无论怎么解释，这个收益风险比率都太低。由此得出的结论是：不要在某个蜡烛图形态出现之时就急于下单交易。请注意，这个启明星的底部一周以后成了支撑位。由此展开的上涨又如期在1220美元区域遭遇抵抗，形成高浪线1与长黑实体2，两者构成一个空头吞噬形态。通常来说，一波小幅上涨之后出现空头吞噬不必太在意。但是，在本例这个具体情况中，它却是值得注意的一个信号，因为它确认了1220美元这个阻力区。</p>
<h1 id="趋势"><a href="#趋势" class="headerlink" title="趋势"></a>趋势</h1><p>“下坡容易上坡难。”</p>
<p>日本有个美丽的说法，描述某些事物间的关系“就像风与云以及花与风的关系一样”。允许我把这个表述挪用到市场交易中。在这里，风代表趋势，云与花代表价格，价格的波动取决于趋势，恰如云和花的摆动控制在风的力量与方向中。因此，在趋势中判定价格的高低是非常重要的。也就是说，在决定新建一个仓位以前，应把当前的蜡烛图组合形态放在行情走势的大背景中来考虑。</p>
<p>如何把蜡烛图形态结合到行情趋势中？我的建议通常是：顺着趋势的方向下单交易，反转信号出现后冲销既有头寸。举例来说，在上升趋势中如果出现空头信号，就要冲销既有的多头头寸（或采取其他保护性措施，包括卖出买入期权，调高卖出（止损）价位）。上升趋势如出现多头信号，则可以建立新的多头头寸。在大幅下降趋势中，操作恰好相反。具体来说就是，在熊市中，主要应等待空头信号，一旦出现就建立新的空头头寸；熊市中的多头信号也可辅助使用，即一旦出现也许就可以考虑平仓既有的空头头寸。</p>
<p>我们可以有多种方法来判断趋势（在本书的下篇中，我们将讨论日本交易员与投资者常用的一些趋势判定方法）。本节的重点不是帮助你找到判定趋势的最佳方法，而是引导你将趋势融入蜡烛图分析之中。但我会讨论西方技术分析中所包含的用来判定趋势的常用方法，例如趋势线与移动平均线等。</p>
<p>读者如果有兴趣学习最流行的西方技术分析工具运用的实战技巧，包括趋势判定技术，我强烈推荐一本书：《期货市场计算机分析指南》（Technical Traders Guide to Computer Analysis of the Futures Market），作者是查尔斯·勒博和大卫·卢卡斯。即使你不以计算机从事交易，也不用让这书名吓着你。这是使用西方技术分析工具从事交易者不可或缺的参考书。</p>
<p>趋势线是判断趋势的最基本方法之一。在图4-7中，从6月下旬到8月上旬之间构成了一条压力线，使得市场一路走熊。然后有多根蜡烛线发出正在筑底的预警信号，具体来说，它们包括：7月的锤子线、8月上旬的启明星、8月下旬的上升窗口（它使得一个岛形底部得以完成）。但是要注意，所有这些向好信号发生的背景是一个熊市市道（体现为那条向下延伸的压力斜线（下降趋势线，也是下降压力线））。只有当行情突破了这条趋势线之后，一个新的多头趋势才获得了确认，行情开始向上攀升，但受阻于9月，形成一个乌云盖顶，而这个乌云盖顶形态又成为后续走势的阻力位。</p>
<p>如图4-8所示，7月初形成了一个空头吞噬组合（两根蜡烛线中间出现空档是因为当时正逢假日）。如果我们看一下整体技术面状况，包括那条趋势线，可以看出，如果根据这个空头吞噬而卖空，那么收益风险比明显过低，因为平仓的目标价位理论上是上升趋势线所构成的支撑位，止损点则在空头吞噬的上端。后来的行情发展证明，一直到7月19日收盘价到达趋势线下方时，这条构成支撑的上升趋势才被确认跌破。</p>
<p>图4-7　确认趋势反转：1991年12月咖啡</p>
<p>图4-8　蜡烛图信号与趋势线：1993年9月5年期票据</p>
<p>图4-9用来说明一种策略：在多头趋势中，多头信号可以用于在价格回落时的买进机会。图4-9a中有一条非常确定的上升趋势支撑线（趋势线受考验的次数越多则越重要）。蜡烛线①是1993年9月15日早盘后的形态，由于当天的交易尚未结束，所以蜡烛线①还不是一条完整的蜡烛线（我们知道一条蜡烛线的完成必须等待收盘后有了收盘价才行）。在图4-9a所停顿的时间点上（9月15日上午），市场刚刚考验了一条长期的上升趋势线（支撑线）。现在让我们把目光转到图4-9b，它是一个30分钟蜡烛图，图中显示，在9月15日上午，蜡烛线构成多头吞噬形态。图中的虚线代表的是与日线图中一样的那条上升趋势线。我们发现，尽管行情不断杀跌，逼近上升趋势线，但这时却出现了一个多头蜡烛图信号。这说明了一个观念，在一个牛市市场中，市场向下修正时也会出现多头蜡烛图信号，而这正是我们需要寻找的买入时机。</p>
<blockquote>
<p>图4-9 蜡烛图与趋势线</p>
</blockquote>
<p>对于以移动平均线来判定趋势的投资者，我利用图4-10来说明如何利用蜡烛图信号在趋势内进行操作。由于行情运行在移动平均线之下，所以趋势是下行的。在这种市道中，可以见空头信号而卖空，而见多头信号则应该平仓空头头寸。偏好风险的交易者可能愿意在熊市中买进，那么就要将短期阻力区作为预定的获利了结目标价位。在本例中，6月的反弹起始于一个包孕形态，但行情碰到52周移动平均压力线后，蜡烛图反映卖压猛增，出现了长上影线（蜡烛线①）和长黑实体（蜡烛线②）。交易者如果在包孕形态处买进，则移动平均线构成的阻力区应该设定为卖出区域。对于喜欢跟着整体趋势顺势交易的投资者而言（在本例中就是逢反弹卖空），前述空头蜡烛图信号可以用来卖空。图中的下降窗口显示空头进一步压低了行情。7月中旬出现了长白实体，暗示市场可能转强，但由此展开的上行再度受阻，形成一个十字星，正位于移动平均线体现的压力区。这是一个特别诱人的卖空时机，因为这个十字星不但正好位处52周移动平均线，而且也正好出现在下降窗口所构成的压力区。行情由此处开始杀跌，出现9根新低蜡烛线后才发生了反弹。</p>
<h1 id="做一个市场变色龙"><a href="#做一个市场变色龙" class="headerlink" title="做一个市场变色龙"></a>做一个市场变色龙</h1><p>“随机应变者胜。”</p>
<p>下单交易，就意味着你对市场的趋势有了自己的期待和判断。但是，市场如水，瞬息万变。因此，你必须持续关注行情的演变轨迹，以确定价格的变动是否符合你的预期。如果市场的发展出乎你的意料，就必须采取恰当的对策。所谓“做一个市场变色龙”，就是要顺应市场情况调整自己。做一个市场变色龙，迅速而有效地适应新的市场环境，是成功交易的关键。数年前我听到过一个很恰当的比喻，将交易比作比剑决斗。比剑决斗的结果，有生有死；交易的结果也是有生有死。在英语中，quick一词有两个意思，一是“迅速”，一是“活着”。在比剑决斗中，你必须反应敏捷，否则就可能丧命。交易也一样。做一个市场变色龙，就是迅速地因应市场的情况，调整自己，这样才能“活下来”继续从事交易。</p>
<p>只要你对行情形成了某个判断，就意味着你认为行情在某个时限内不会到达某个价位。如果行情恰恰在这段时间内达到了这一价位，就证明你的预测是错误的。在这里，我用图4-11来阐明这个概念。在图4-11中，10月下旬形成了一个乌云盖顶形态，于是我看空后市，因为许多技术信号在这里交汇在一起，暗示行情不会收盘于36美元上方。而且，我有四个理由来判断此后的反弹（如果有的话）都不能越过35.50～36.00美元：</p>
<p>·乌云盖顶的高点35.50美元应该会成为阻力位。</p>
<p>·有一个小型下降窗口在36.00美元附近构成阻力。</p>
<p>·下降窗口形成之前的三个交易日的蜡烛线低点在36.00美元。按照旧支撑会转变为新阻力的理论，这个价位会成为阻力位。</p>
<p>·按斐波那契折返幅度（62%反弹或回调幅度，相当于黄金分割）理论测算，市场如果反弹，反弹幅度应不超过A点与B点之间的跌幅的62%，算下来这个高度大约在35.50美元。</p>
<blockquote>
<p>图4-11 寻找改变市场舆论的价格</p>
</blockquote>
<p>在本例中，如果多方有足够的力量推升价格，使之收盘于35.50～36.00美元阻力区的高点以上，就会证明我的判断发生了错误，此时必须改变看空的立场。换言之，我必须改变自己的判断，以适应新的市场条件。但行情的发展验证了我的判断，多头在见到乌云盖顶形态后数周内试图上攻35.50～36.00美元的阻力区，但无功而返。</p>
<p>在图4-12中，12月下旬的吊颈线与空头吞噬（中间的空档是假日）确认20美元附近是个阻力位。在这个区域，价格开始下滑，1月上旬行情在前一个月形成的19美元附近支撑位试图企稳。但是，1月12日的长黑实体跌破了19美元的支撑位。至此，所有的信号都是负面的。但是，长黑实体之后的高浪线发出蜡烛图信号，提示市场可能“变脸”。下一周，盘面又形成启明星形态，再次提示应该改变此前的看空判断。此后出现上升窗口，成为市场逆转的最后一个证据。</p>
<p>图4-12　做个紧跟市场的变色龙：1993年3月原油</p>
<h1 id="计算机与蜡烛图"><a href="#计算机与蜡烛图" class="headerlink" title="计算机与蜡烛图"></a>计算机与蜡烛图</h1><p>“最锋利的刀，最应该小心使用。”</p>
<p>许多技术分析师会利用计算机来测试各种交易策略。随着计算机的日益普及以及蜡烛图理论的广泛流行，交易者可能希望用计算机来筛选最可靠或最重要的蜡烛图组合形态。对这些人士，我有个忠告：除了让计算机帮你寻找、挑选蜡烛图形态以外，还有许多因素必须纳入思考。这是本节的讨论重点。</p>
<p>蜡烛图形态出现的位置</p>
<p>如前所述，任何蜡烛图信号都必须置于此前的市场技术形态这个大背景中来观察。这与人们经常问我的一个问题有关：哪些蜡烛图形态最重要？在回答这个问题时，我总是首先建议考虑形态所传达的行情信号。例如，在比较乌云盖顶与空头吞噬形态哪个更重要时，我一般会认为，空头吞噬形态似乎更重要一些，因为这个形态中的第二根黑线收盘于前一根白色实体的下方，而乌云盖顶的第二根黑线只切入第一根白线的实体内部。所以，相比乌云盖顶形态，空头吞噬显示的空方控制程度更强（见图4-13）。</p>
<p>图4-13　乌云盖顶与空头吞噬比较</p>
<p>但是，我们绝不可以孤立地看待任何一个蜡烛图组合形态的意义，交易者必须观察这个形态周围的技术面。例如，如果乌云盖顶发生在重要的阻力位，而空头吞噬并不是出现在这种位置，那么前者的空头反转信号就强于后者。孤立地看一个形态是非常危险的，前面出现过的图4-5可以表明这一点：就收益风险比率来考察，图中的乌云盖顶相比空头吞噬形态而言，是个更诱人的交易（做空）机会，而那个空头吞噬则实际上没有构成机会，是个诱人的陷阱。一位日本交易员对此有句很有道理的话：“形态的位置比形态本身更重要。”因此，当你决定测试某个蜡烛图形态的可靠性时，绝对不可以只根据这一个形态来进行买卖决策，首先必须分析形态所在的位置。</p>
<p>如何决定一个蜡烛图形态的具体标准</p>
<p>对蜡烛图形态的判读，所依据的是对市场心理的正确推断。想想看，如果出现乌云盖顶，意味着市场发生了什么变化？在一根强劲的长白实体之后，行情高开，但收盘价低于前一根白线的收盘价，这不是清晰地显示空方已经从多方手中夺取了控制权吗？但是，蜡烛图形态是形态，不是数学，不直接依据数据来做判断，这一点使其区别于移动平均线及摆动率，对后两者可以很容易地进行计算判断。以移动平均线来说，今天的数据是否高于昨天，计算机可以给出明确的判断。蜡烛图形态不是如此清晰、明确，在判断某个蜡烛图或某个蜡烛图组合是否属于某种形态时，必然依赖主观解释。</p>
<p>在标准的乌云盖顶中，第二根黑线必须切入第一根白线实体的中点以下，这是一个可以量化的规则。如果某个形态像乌云盖顶，但又不是非常标准，黑色实体没有切入白色实体中点的下方，那么严格按标准工作的计算机，在筛选中就会排除这个形态。但是，如果这个非标准形态发生在重要阻力位呢？在这种情况下，我会将其视为与传统乌云盖顶形态有一样的空头内涵，如果依赖计算机而忽略这个形态的空头信号，显然是危险的。图4-14就反映了这种情况，我在乌云盖顶后面加了一个问号，因为它不是一个标准的乌云盖顶，第二根黑线的收盘价未到达前一个白色实体的中点以下。尽管如此，我仍然视之为乌云盖顶，理由如下：首先，黑线的上影线非常长，显示价格迅速从高点大幅下撤；其次，这根黑线的收盘位破坏了市场的技术面，因为它把价格压制在先前的一个高点（图中标示为H）以下，这是一个上插形态，是个空头信号；最后，乌云盖顶以后，行情收低，再次确认市场的内在弱势。</p>
<p>因此，即使只是让计算机帮你做一些最基本的筛选工作，也可能产生问题。如果要依赖计算机进行蜡烛图形态寻找与筛选，请记住，所有的这些标准形态只是信号标杆而已。标准形态相对容易量化，可以依赖计算机进行判别，而非标准形态也不容轻易放过，因为它们往往也是重要的市场信号。在这种情况下，主观判断就非常重要了，非计算机可为。这和标准条形图的识别中所涉及的主观成分其实是一样的。</p>
<p>图4-14　蜡烛图与主观性：美国银行—日线</p>
<p>下单交易</p>
<p>一旦某个蜡烛图形态出现，是否意味着它发出了买进或卖出信号？当然不是。如前所述，不能根据一个孤立的形态进行交易，必须首先考察这个形态形成时的整体技术面。</p>
<p>以流星线为例，如果某个流星线同时形成一个上升窗口，计算机程序会根据这个形态给出不恰当的卖出信号，图3-49反映的就是这种情况，后来的发展证明了这是一个错误的卖出时机。所以，让计算机根据形态给出交易信号，然后据此交易，而忽略当时的整体技术面情况（包括重要趋势、先前的价格变动等），就可能犯下错误。</p>
<p>另一个要考虑的重要问题是本章讨论过的收益风险比率问题。当一个蜡烛图组合形态出现时，并不一定就意味着要根据其信号进行交易。例如，如果黄金市场出现了一个启明星形态，潜在收益目标价位是15美元，而潜在风险也是15美元，是否还要按照这个多头信号进行交易？根据这个形态建立多头头寸是否合理？在本例中，回答当然是否定的。因此，某个交易是否合理，是否合算，取决于这个形态形成时市场当时的风险度、潜在收益率参数。</p>
<p>再举一例，在图4-15中，有两根锤子线。锤子线通常有潜在的多头意义，但从收益风险比率考虑，图中这两根锤子线都不构成做多理由。在这两个形态发生时，潜在风险大约都是15～20点（假定在行情下行到锤子线的低点以下时进行止损交易），而潜在收益是20～25点（因为425附近是阻力位）。如果根据计算机程序自动决策进行交易，在本例中都可以获利，因为在锤子线之后果然行情上涨。但是，从理论上讲，根据合理的资金管理原则，这两个多头信号还是放弃为好，因为相对于潜在收益而言，风险度还是过大。</p>
<p>图4-15　一笔交易的风险收益比</p>
<p>何时冲销一笔头寸</p>
<p>在计算机上进行止损设置是很容易的事情（某些计算机程序甚至没有设定止损，完全违背风险管理的概念，是一种非常危险的操作程序），但止损目标究竟如何决定呢？某个时候，某位交易者可能会设在上周的低点，而下一次，某位交易者可能将其设在支撑线上或者50%的反弹位或回落位。每一位交易者都有自己的风格，因此利用计算机进行蜡烛图买卖操作时，要考虑自己的个性。</p>
<p>在图4-16中，有一个黄昏星形态和一个多头吞噬形态。多头吞噬形态出现后，可以预期价格将会反弹，但反弹的目标价位如何设定呢？必须依赖其他的技术分析工具，因为蜡烛图理论通常不提供目标价位。</p>
<p>图4-16　蜡烛图与价格目标：1992年12月英镑</p>
<p>原先的支撑可以转化为阻力。根据这个理论，某位交易者也许会将目标价位设在七八月的支撑区，大约在1.85美元处。从图4-16中可以看出，如此期待，交易显然不会成功。但是，如果有另一位交易者根据斐波那契比率理论，将反弹幅度设定为9月高点到低点之间跌幅的38%，交易就会取得成功。对于第一位交易者来说，因为所设定的目标1.85美元没有达到，他也许就会认为这个多头信号不可靠。对于第二位交易者来说，行情符合预期，实现了目标（38%的反弹），他就会认为这个多头信号很成功。因此，在判定某个蜡烛图形态是否可靠时，必须考虑交易者的风格。</p>
<p>如何依据蜡烛图交易，很大程度上取决于你的交易理念、风险偏好与个性，而这些都是非常个人化的因素。如果你决定测试蜡烛图形态的可靠性，或者利用计算机来帮助你进行蜡烛图交易，还需要给自己定下交易标准和规则。在将蜡烛图应用于市场时，一定要考虑自己的交易风格。只有将这三者（蜡烛图理论、市场、交易个性）有机结合在一起，才能发挥蜡烛图的巨大威力。</p>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/日本蜡烛图技术新解/" rel="tag"># 日本蜡烛图技术新解</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/01/25/第3章-蜡烛图组合形态/" rel="next" title="第3章 蜡烛图组合形态">
                <i class="fa fa-chevron-left"></i> 第3章 蜡烛图组合形态
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/01/26/第五章-星线/" rel="prev" title="第五章 星线">
                第五章 星线 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpg" alt="CheBin">
            
              <p class="site-author-name" itemprop="name">CheBin</p>
              <div class="site-description motion-element" itemprop="description">放弃会成为一种习惯</div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">262</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                      <a href="/categories/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">31</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          

          

          
          


          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <!-- modify icon to fire by szw -->
                <i class="fa fa-history fa-" aria-hidden="true"></i>
                近期文章
              </div>
              <ul class="links-of-blogroll-list">
                
                
                  <li>
                    <a href="/2021/04/11/第19章-抓住超级行情的激动/" title="第19章 抓住超级行情的激动" target="_blank">第19章 抓住超级行情的激动</a>
                  </li>
                
                  <li>
                    <a href="/2021/04/10/第18章-一定要控制风险，限制亏损/" title="第18章 一定要控制风险，限制亏损" target="_blank">第18章 一定要控制风险，限制亏损</a>
                  </li>
                
                  <li>
                    <a href="/2021/04/08/第17章-市场无好坏之分/" title="第17章 市场无好坏之分" target="_blank">第17章 市场无好坏之分</a>
                  </li>
                
                  <li>
                    <a href="/2021/04/08/第15章-持有利润最多的仓位；平掉亏损最多的仓位/" title="第15章 持有利润最多的仓位；平掉亏损最多的仓位" target="_blank">第15章 持有利润最多的仓位；平掉亏损最多的仓位</a>
                  </li>
                
                  <li>
                    <a href="/2021/04/08/第14章-善用周而复始的季节性波动/" title="第14章 善用周而复始的季节性波动" target="_blank">第14章 善用周而复始的季节性波动</a>
                  </li>
                
              </ul>
            </div>
        

          
            
          
          

        </div>
      </div>

      
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#止损"><span class="nav-number">1.</span> <span class="nav-text">止损</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#风险与收益的权衡"><span class="nav-number">2.</span> <span class="nav-text">风险与收益的权衡</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#趋势"><span class="nav-number">3.</span> <span class="nav-text">趋势</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#做一个市场变色龙"><span class="nav-number">4.</span> <span class="nav-text">做一个市场变色龙</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#计算机与蜡烛图"><span class="nav-number">5.</span> <span class="nav-text">计算机与蜡烛图</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2021</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CheBin</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">2.3m</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">35:19</span>
  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a></div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.1"></script>

  <script src="/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/js/src/affix.js?v=7.0.1"></script>

  <script src="/js/src/schemes/pisces.js?v=7.0.1"></script>



  
  <script src="/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/js/src/next-boot.js?v=7.0.1"></script>


  

  

  

  


  


  
  <script>
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url).replace(/\/{2,}/g, '/');
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x"></i></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x"></i></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
  

  
  

  


  

  

  

  

  

  

  

  

  
<script>
  $('.highlight').each(function(i, e) {
    var $wrap = $('<div>').addClass('highlight-wrap');
    $(e).after($wrap);
    $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function(e) {
      var code = $(this).parent().find('.code').find('.line').map(function(i, e) {
        return $(e).text();
      }).toArray().join('\n');
      var ta = document.createElement('textarea');
      var yPosition = window.pageYOffset || document.documentElement.scrollTop;
      ta.style.top = yPosition + 'px'; // Prevent page scroll
      ta.style.position = 'absolute';
      ta.style.opacity = '0';
      ta.readOnly = true;
      ta.value = code;
      document.body.appendChild(ta);
      ta.select();
      ta.setSelectionRange(0, code.length);
      ta.readOnly = false;
      var result = document.execCommand('copy');
      
        if (result) $(this).text('复制成功');
        else $(this).text('复制失败');
      
      ta.blur(); // For iOS
      $(this).blur();
    })).on('mouseleave', function(e) {
      var $b = $(this).find('.copy-btn');
      setTimeout(function() {
        $b.text('复制');
      }, 300);
    }).append(e);
  })
</script>


  

  

</body>
</html>
